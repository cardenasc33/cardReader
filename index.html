<!DOCTYPE html>
<html>
    <head>
    
    </head>
    <body>
        
        <br></br>
        <input id = "text" type="text" oninput="getText()">
       
        <p id = "total"> Total Characters: 0</p>
        <p id = "status"> Status: Please Swipe Card</p>
        <p id = "uin">UIN: </p>
        <p id="prefix">Prefix: </p>
        <button id = "resetButton" onclick="resetFields()" >Reset</button> 

        <div id = "userInfo">User Info: </div>
    </body>
   
   <script>
   
        
        /* Resets all the fields when reset button is pressed */
        function resetFields(){
            document.getElementById("text").value = "";
            document.getElementById("total").innerHTML = "Total Characters: 0";
            document.getElementById("status").innerHTML = "Status: Please Swipe Card";
            document.getElementById("uin").innerHTML = "UIN: ";
            document.getElementById("prefix").innerHTML = "Prefix: ";
        }

        function getText(){
            var textInput = document.getElementById('text').value;
            textInput = textInput.replace(/\s/g, ''); 
            count(textInput);
            
        }
        function count(textInput){
            var total = textInput;
            total = total.replace(/\s/g, '');
            document.getElementById("total").innerHTML="Total Characters: " + (total.length);
            
            statusUpdate(total.length , total); 

        }
            
        function statusUpdate(len , text){ //Param is the number of characters in the input field
    
            var maxLength = 79; //Total amount of characters for a successful card swipe
            var prefix = text.toString().substring(0, 2); //obtains the prefix characters of the input (ex. %B)  

            document.getElementById("prefix").innerHTML= "Prefix: " + prefix;

                if (len == 0){ 
                    document.getElementById("status").innerHTML="Status: " + "Please Swipe Card";
                }
                if (len == maxLength && prefix == "%B"){
                    document.getElementById("status").innerHTML="Status: " + "Success"; //Card was read properly
                    getUIN(text); //Calls the function getUIN() to obtain the UIN substring
                }
                else{
                    document.getElementById("status").innerHTML="Status: " + "Error, please swipe again"; //Card did NOT read properly
                
                }
        }

        function loadDoc(){
            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {
                    document.getElementById("userInfo").innerHTML = "User Info: " + this.responseText;
                }
            };
            xhttp.open("GET", "test1.json", true);
            xhttp.send();
        }

        /* called if UIN is obtainable 
         * searches UIN in the database,
         * displays info for matching UIN
         * 
         */ 
        function getUIN(text){
            var uin = text.substring(54, 63); //Obtains the string of the UIN
            document.getElementById("uin").innerHTML="UIN: " + uin;

            //AJAX call , searches UIN, pull info 
            loadDoc(); //loads data from json file
        }


    </script>


</html>